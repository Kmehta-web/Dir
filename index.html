<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Text Submission</title>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        .red-background {
            background-color: red;
            color: white;
        }
    </style>
</head>
<body>

    <h1>Secure Text Submission</h1>

    <!-- Google Sign-In Button -->
    <button onclick="googleLogin()">Login with Google</button>
    <button onclick="signOut()">Sign Out</button>
    <p id="user-info"></p>

    <form id="submissionForm">
        <input type="text" id="textInput" placeholder="Enter your text" required>
        <button type="submit">Submit</button>
    </form>

    <table id="submissionTable">
        <thead>
            <tr>
                <th>Text</th>
                <th>Date/Time</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // Firebase Configuration (Replace with your Firebase credentials)
        const firebaseConfig = {
           apiKey: "AIzaSyDutDyTo8sbmI8ftpIp3K5DtkgmV5uJYPw",
   authDomain: "grcs-69b66.firebaseapp.com",
   projectId: "grcs-69b66",
   storageBucket: "grcs-69b66.firebasestorage.app",
   messagingSenderId: "621698190294",
   appId: "1:621698190294:web:a4e08432305b59ae75b277",
   measurementId: "G-NQ91XL5NMJ"

        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        let user = null;

        // Google Sign-In (No need for Client ID manually)
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    user = result.user;
                    document.getElementById("user-info").innerText = `Logged in as: ${user.displayName}`;
                })
                .catch(error => console.error("Login Failed", error));
        }

        function signOut() {
            auth.signOut().then(() => {
                user = null;
                document.getElementById("user-info").innerText = "Logged out";
            });
        }

        // Form Submission
        document.getElementById('submissionForm').addEventListener('submit', function(event) {
            event.preventDefault();
            let textInput = document.getElementById('textInput').value;
            if (!user) {
                alert('Please login using Google first!');
                return;
            }

            let currentDateTime = new Date().toLocaleString();
            let isJWT = false;

            // Verify if the input is a JWT token
            try {
                let decodedToken = jwt_decode(textInput);
                if (decodedToken && decodedToken.header.alg === 'ES256') {
                    isJWT = true;
                }
            } catch (e) {
                console.log("Not a valid JWT");
            }

            // Add row to the table
            let row = document.createElement('tr');
            if (isJWT) row.classList.add('red-background');
            row.innerHTML = `<td>${textInput}</td><td>${currentDateTime}</td>`;
            document.querySelector('#submissionTable tbody').appendChild(row);

            document.getElementById('textInput').value = ''; // Clear input
        });
    </script>

</body>
</html>
